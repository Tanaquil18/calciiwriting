<?xml version="1.0" encoding="UTF-8" ?>
<!-- **********************************************************************-->
<!-- Copyright 2012-2019                                                   -->
<!-- Matthew Boelkins                                                      -->
<!--                                                                       -->
<!-- This file is part of Active Calculus.                                 -->
<!--                                                                       -->
<!-- Permission is granted to copy, distribute and/or modify this document -->
<!-- under the terms of the Creative Commons BY-SA license.  The work      -->
<!-- may be used for free by any party so long as attribution is given to  -->
<!-- the author(s), the work and its derivatives are used in the spirit of -->
<!-- "share and share alike".  All trademarks are the registered marks of  -->
<!-- their respective owners.                                              -->
<!-- **********************************************************************-->
<section xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="sec-partial-fractions">
  <title>The Method of Partial Fractions</title>
  <objectives>
    <ul>
      <li>
        <p>
          How can we integrate rational functions when substitution does not work?
        </p>
      </li>

      <li>
        <p>
          How do we break a rational function up into the sum of simpler rational functions?
        </p>
      </li>

      <li>
        <p>
          What condition must be met in order to rewrite a rational function in this way? <!-- How do we perform long division of polynomials? -->
        </p>
      </li>
    </ul>
  </objectives>

  <introduction>
    <p>
      The need to integrate rational functions arises in differential equations and in other settings,
      and so we wonder about how to integrate them.  If we are lucky, we can use substitution or integration by parts, 
      but sometimes neither of those methods can be used.  
    </p>

    <!-- <xi:include href="./previews/PA-1-1.xml" />-->
    <!-- Put preview here.  A webwork version, needs to go in a separate file eventually. 
      Also needs to be rewritten as 1 ww problem instead of 4?-->

    <!-- <title>Preview Activity</title>
  <exercise label="csafranski__5-_5aPreview_prob1">
    <webwork source="csafranski/5.5aPreview_prob1.pg"/>
  </exercise>-->

    <!-- Also do a non-WeBWorK version? -->

    <example><title>Integrating A Rational Function with Substitution</title>
      <statement>
        <p>
          Evaluate
          <me>
            \int \frac{5x}{x^2-1} \, dx
          </me>.
        </p>
      </statement>
      <solution>
        <p>
          Placeholder for solution.
        </p>
      </solution>
    </example>

    <p>
      In this case, the derivative of the function in the denominator was sitting in the numerator 
      (up to a constant multiple).  What if we needed to integrate this instead?
      <me>
        \int \frac{5x}{x^2-x-2} \, dx
      </me>?
    </p>
    <p>
      If we try to pick <m>u=x^2-x-2</m>, then we calculate that <m>du=(2x-1)\, dx</m>, which does not help
      us in the numerator.  
    </p>
    <p>
      So we try a different strategy.  If we somehow knew that 
      <me>
        \frac{5x}{x^2-x-2} = \frac{10/3}{x-2} + \frac{5/3}{x+1}
      </me>, 
      then we could integrate both sides of the equation to get 
      <me>
        \int \frac{5x}{x^2-x-2} \, dx = \int \frac{10/3}{x-2} + \frac{5/3}{x+1} \, dx
      </me>, and the integral on the right is straightforward, giving us
      <me>
        \int \frac{5x}{x^2-x-2} \, dx = \frac{10}{3} \ln|x-2| + \frac{5}{3}\ln|x+1| + C
      </me>.
    </p>
    <p>
      We can verify that 
      <me>
        \frac{5x}{x^2-x-2} = \frac{10/3}{x-2} + \frac{5/3}{x+1}
      </me>
      is indeed true by recombining the right-hand-side of the equation using a common denominator.  
      <md>
        <mrow> \frac{10/3}{x-2} + \frac{5/3}{x+1} \amp = \frac{10/3(x+1)}{(x-2)(x+1)} + \frac{5/3(x-2)}{(x+1)(x-2)}</mrow>
        <mrow> \amp =\frac{\frac{10}{3}x+\frac{10}{3}+\frac{5}{3}x-\frac{10}{3} }{(x-2)(x+1)}</mrow>
        <mrow> \amp =\frac{ \frac{15}{3}x}{(x-2)(x+1)}</mrow>
        <mrow> \amp =\frac{5x}{x^2-x-2}</mrow>
         
      </md>
    </p>
    <p>
      But how did we come up with
      <me>
        \frac{5x}{x^2-x-2} = \frac{10/3}{x-2} + \frac{5/3}{x+1}
      </me>
      in the first place?
    </p>

    <p>
        One clue is that the denominator of the rational function in the integral factors into two linear terms,
        <me>
          x^2-x-2 = (x-2)(x+1)
        </me>,
        and those are exactly the denominators of the simpler rational functions we used.   
    </p>

    <p>
      We suppose that
          <me>
            \frac{5x}{(x-2)(x+1)} = \frac{A}{x-2} + \frac{B}{x+1}
          </me>
      and then we can look for the constants <m>A</m> and <m>B</m>.
    </p>

    <p>
          Multiplying both sides of this equation by <m>(x-2)(x+1)</m>,
          we find that
          <me>
            \frac{5x\cancel{(x-2)(x+1)}}{\cancel{(x-2)(x+1)}}= \frac{A(x+1)\cancel{(x-2)}}{\cancel{x-2}} + \frac{B\cancel{(x+1)}(x-2)}{\cancel{x+1}}
          </me>
          

          which means
          <me>
            5x = A(x+1) + B(x-2)
          </me>.
    </p>

    <p>
          Since we want this equation to hold for <em>every value</em> of <m>x</m>,
          we can use inspired choices of <em>specific</em> <m>x</m>-values to help us find <m>A</m> and <m>B</m>.
          Taking <m>x = -1</m>, we have
          <me>
            5(-1) = A(0) + B(-3)
          </me>,
          so <m>B = \frac{5}{3}</m>.
          Choosing <m>x = 2</m>, it follows
          <me>
            5(2) = A(3) + B(0)
          </me>,
          so <m>A = \frac{10}{3}</m>.
          Thus,
          <me>
            \int \frac{5x}{x^2-x-2} \, dx = \int \frac{10/3}{x-2} + \frac{5/3}{x+1} \, dx
          </me>.
    </p>
  </introduction>

  <subsection>
    <title>Distinct Linear Terms (Or Factor the Denominator), or when can this be used?</title>
    <p>
      Notice that any terms of the form <m>\frac{A}{ax+b}</m>, a number in the numerator divided by a linear term
      in the denominator would be similarly easy to integrate.  
      <me>
        \int \frac{A}{ax+b} \, dx = \frac{A}{a}\ln|ax+b|+C
      </me>
      So the question to explore in the next activity is: When can we integrate a rational function by rewriting into terms like this?

      <!-- A similar method can be used whenever the denominator factors into distinct linear terms, as long
      as the numerator meets some conditions.   -->
    </p>

    <p>
      Do activity now?  Explore how to combine various partial fraction decompositions and have them make 
      conclusions or guesses about what the conditions are? Do linear ones, ones with numerator also a quadratic.
      Do any quadratic ones? Or repeated linear terms? Have them try a constant over a quadratic that doesn't work.
    </p>
  </subsection>
  <subsection xml:id="subsec-part-frac-2">
    <title>Method of Partial Fractions</title>
    <p>
      As we saw in the activity, we have to be careful with the form of our partial fraction decomposition
      if factoring the denominator results in anything other than distinct linear terms.  
    </p>
    <p>
      For example, when we had a numerator of <m>x^2+x+4</m>, there are <m>3</m> numbers: the coefficient
      of the <m>x^2</m> term, the coefficient of the <m>x</m> term, and the constant term.  Using
      <m>\frac{A}{x-1}+\frac{B}{x^2+1}</m> gave us <m>2</m> numbers to solve for, <m>A</m> and <m>B</m>,
      and in this case, it is impossible to find values of <m>A</m> and <m>B</m> to make the equality hold.  But we can
      modify the partial fraction form to introduce a third number.
    </p>
    <example><title>Integrating A Rational Function with Substitution</title>
      <statement>
        <p>
          Evaluate
          <me>
            \int \frac{x^2+x+4}{(x^2+1)(x-1)} \, dx
          </me>.
        </p>
      </statement>
      <solution>
        <p>
          We suppose that
            <me>
            \frac{x^2+x+4}{(x^2+1)(x-1)} = \frac{A}{x-1} + \frac{Bx+D}{x^2+1}
            </me>
          and note that this gives us <m>3</m> constants to work with.<fn>We avoid using <m>C</m> as a coefficient because we
          don't want to get it confused with the <m>+C</m> at the end of an indefinite integral.</fn>  Before we look for the values
           of the constants <m>A</m>, <m>B</m> and <m>D</m>, we will integrate to make sure this is a better
           form than the one we started with.  
        </p>
        <p>
          An antiderivative of <m>\frac{A}{x-1}</m> is <m>A\ln|x-1|</m>. We can calculate
          <me>
            \int \frac{Bx+D}{x^2+1} \, dx = \int \frac{Bx}{x^2+1} \, dx + \int \frac{D}{x^2+1} \, dx
          </me>
          and note that the second integral is one of our basic forms, <m>D\arctan(x)</m>, while the first
          can be evaluated with substitution taking <m>u=x^2+1</m> so that <m>du=2x\, dx</m>.
        </p>
        <p>
          Thus we see that if we can find such numbers <m>A</m>, <m>B</m> and <m>D</m>, then we can integrate
          <md>
            <mrow> \int \frac{x^2+x+4}{(x^2+1)(x-1)} \, dx \amp = \int \left(\frac{A}{x-1} + \frac{Bx+D}{x^2+1}\right) dx</mrow>
            <mrow> \amp = \int \frac{A}{x-1} dx + \int \frac{Bx}{x^2+1}dx + \int \frac{D}{x^2+1}dx</mrow>
            <mrow> \amp = A\ln|x-1|+\frac{B}{2}\ln|x^2+1|+D\arctan(x) +C </mrow>
          </md>
        </p>
        <p>
          Now that we've done the calculus part, we turn our attention to the algebra.  
          Multiplying both sides of the integrand by <m>(x-1)(x^2+1)</m>,
          we find that
          <me>
            \frac{(x^2+x+4)\cancel{(x-1)(x^2+1)}}{\cancel{(x-1)(x^2+1)}}= \frac{A(x^2+1)\cancel{(x-1)}}{\cancel{x-1}} + \frac{(Bx+D)\cancel{(x^2+1)}(x-1)}{\cancel{x^2+1}}
          </me>
          which means
          <me>
            x^2+x+4 = A(x^2+1) + (Bx+D)(x-1)
          </me>.
        </p>
        <p>
          We have several tools in our toolbox for solving for the unknown numbers.
          We could... 
          <ul>
            <li>
              <p>
                ... use the black box method.  Use a solver like Wolfram Alpha or another computational tool.
              </p>
            </li>
            <li>
              <p>
                ... set <m>x</m> equal to different values like we've done before.  
                This is slightly more complicated than when the denominator factored into linear terms, 
                but we can still do it, taking <m>x=1</m>, then <m>x=0</m>, then <m>x=-1</m>, or any three
                values of <m>x</m> you choose and find easiest to work with.
              </p>
            </li>
            <li>
              <p>
                ... compare coefficients of both sides of the equation and get a system of equations to solve.
              </p>
            </li>
          </ul>
        </p>
        <p>
          Since the other two methods don't give us anything new to discuss, we choose to 
          demonstrate the last method here.  Recall that we are trying to solve
          <me>
            x^2+x+4 = A(x^2+1) + (Bx+D)(x-1)
          </me>
          for the unknown values of <m>A</m>, <m>B</m> and <m>D</m> so that the two sides are equal
          for all possible values of <m>x</m>.  This means the two sides must really be the same function
          of <m>x</m>, or the same polynomial of <m>x</m>.  Multiplying out the right-hand side and grouping
          like terms together gives
          <md>
            <mrow> x^2+x+4 \amp = A(x^2+1) + (Bx+D)(x-1) </mrow>
            <mrow> \amp = Ax^2+A + Bx^2-Bx+Dx-D</mrow>
            <mrow> \amp = (A+B)x^2+(-B+D)x+(A-D)</mrow>
          </md>
          Setting like coefficients equal means that <m>A+B=1</m>, and <m>-B+D=1</m> and <m>A-D=4</m>
        </p>
        <p>
          This gives us a system of linear equations, three equations and three unknowns.  Combining this
          with the second method, of setting <m>x=1</m> to find that <m>1^2+1+4=A(1^2+1)+(Bx+D)(1-1)</m> and so
          <m>A=3</m> would reduce this to two unknowns and often be the fastest to solve by hand. (Since <m>A=3</m>
          and <m>A+B=1</m>, this means that <m>B=-2</m>; similarly, since <m>A-D=4</m>, this means that <m>D=-1</m>.)
        </p>
        <p>
          But it's worth noting that we can use matrices to solve a system of linear equations, and that would give us
          <md>
            <mrow>A \amp+ B \amp \amp=1 </mrow>
            <mrow> \amp- B \amp+D \amp=1 </mrow>
            <mrow>A \amp \amp-D \amp=4 </mrow>
          </md>
          which becomes <m>\begin{bmatrix} 1 \amp 1 \amp 0 \amp 1 \\ 0 \amp -1 \amp 1 \amp 1 \\1 \amp 0 \amp -1 \amp 4 \end{bmatrix}</m>.
          Solving this using Gaussian elimination results in <m>\begin{bmatrix} 1 \amp 0 \amp 0 \amp 3 \\ 0 \amp 1 \amp 0 \amp -2 \\0 \amp 0 \amp 1 \amp -1 \end{bmatrix}</m>,
          which does give us the same values of <m>A=3</m>, <m>B=-2</m>, and <m>D=-1</m>.  But doing this tells us something more:
          that this system of equations will have a unique solution <alert>regardless of the starting coefficients of the quadratic in the numerator.</alert>
        </p>
        <p>
          This bears repeating:  as long as the numerator is less than or equal to degree <m>2</m>, and the denominator factors into a linear and an irreducible quadratic,
          we can find a partial fraction decomposition and calculate the integral by setting it up in this way, with a constant over the linear factor
          and a linear term over the quadratic factor.  
        </p>
      </solution>
    </example>
    <p>
        Let's summarize what we have so far about forms of partial fraction decompositions.
      </p>
    <assemblage>
      <title>Partial Fraction Decomposition</title>
      <p>
        Given any rational function with the degree of the numerator strictly less than the degree 
        of the denominator, we can rewrite the function as a sum of simpler terms. 
      </p>
            <tabular>
              <row bottom="minor" halign="center">
                <cell>Denominator Contains</cell>
                <cell>Partial Fraction Decomposition Contains</cell>
              </row>
              <row>
                <cell><m>(ax+b)</m></cell>
                <cell><m>\frac{A}{ax+b}</m></cell>
              </row>
              <row>
                <cell><m>(ax+b)^n</m></cell>
                <cell><m>\frac{A_1}{ax+b}+\frac{A_2}{(ax+b)^2}+\cdots + \frac{A_n}{(ax+b)^n}</m></cell>
              </row>
              <row>
                <cell><m>(ax^2+bx+c)</m></cell>
                <cell><m>\frac{Ax+B}{ax^2+bx+c}</m></cell>
              </row>
              <row>
                <cell><m>(ax^2+bx+c)^n</m></cell>
                <cell><m>\frac{A_1x+B_1}{ax^2+bx+c}+\frac{A_2x+B_2}{(ax^2+bx+c)^2}+\cdots + \frac{A_nx+B_n}{(ax^2+bx+c)^n}</m></cell>
              </row>
            </tabular>
      <!-- Make a table with this... denominator contains term | partial fraction decomposition contains -->
    </assemblage>
      
    <p>
      This can be summarized in the following way. 
      <ul>
        <li>
          <p>
            When the factored form of the denominator contains a linear term, the partial fraction decomposition
      contains a constant over that linear term.
          </p>
        </li>
        <li>
          <p>
            When the factored form of the denominator contains a power
      of a linear term, the partial fraction decomposition contains a constant over every power of that linear term
      up to the max power.
          </p>
        </li>
        <li>
          <p>
            When the factored form of the denominator contains a quadratic term, the partial fraction
      decomposition contains a linear term divided by the quadratic term.
          </p>
        </li>
        <li>
          <p>
            When the factored form of the denominator contains a power
      of a quadratic term, the partial fraction decomposition contains a linear term over every power of that quadratic term
      up to the max power.
          </p>
        </li>
      </ul>      
    </p>
  
<!-- would be great to have a multiple choice or two or three here as an interactive example. 
maybe culminate with 1/(x+2)^3? because students in this section don't realize that's already simplified? -->
    <p>
      Do another example, including a quadratic and setting coefficients of like terms equal.
    </p>
    <p>
      Do next 2 actitivities.
    </p>
  </subsection>

  <subsection xml:id="subsec-part-frac-3">
    <title>Final Considerations</title>
    
    <p>
      An astute reader might notice that we said that the denominator can contain terms of the form
      <m>ax^2+bx+c</m> but we only considered terms of the form <m>x^2+k</m> in our examples and activities.
      The reason is that every <m>ax^2+bx+c</m> can be written as <m>a\left( \left(x-\frac{b}{2a}\right)^2+k\right)</m>
      if we recall how to <em>complete the square</em> from algebra class, and then using a substitution <fn><m>y=x-\frac{b}{2a}</m>
      so that <m>dy=dx</m></fn> turns this into some constant number multiplied by <m>y^2+k</m>.
    </p>
    <p>
      But this turns a calculus problem into even more of an algebra problem, and the focus of this material 
      is integration, not algebra.
    </p>
    <p>
      You might also be wondering what happens if the denominator doesn't factor into powers of linear and quadratic terms.
      It is a theorem beyond the scope of this class, called the Fundamental Theorem of Algebra, that every polynomial over the real numbers factors into
      powers of linear and quadratic terms. 
      <!-- Is it really the FTA or is there another theorem for the real case? -->
    </p>

    <p>
      The result is that every rational function, regardless of the degree of the numerator or denominator,
      or how the denominator factors, can be integrated using some combination of the techniques
      described in this section.  Putting that theory into practice, however, is very often no trivial matter!
    </p>

    <!-- <xi:include href="./activities/act-1-1-1.xml" /> -->
    <!-- <xi:include href="./activities/act-1-1-2.xml" /> -->
     <!-- <xi:include href="./activities/act-1-1-3.xml" /> -->
  </subsection>

  <subsection>
    <title>Summary</title>
    <p>
      <ul>
        <li>
          <p>
            Given any rational function with the degree of the numerator strictly less than the degree 
            of the denominator, we can rewrite the function as a sum of terms of the form
              <me>
                \frac{A}{ax+b},\ \frac{A}{(ax+b)^n},\ \frac{Ax+B}{ax^2 + bx+c},\ \text{or }\frac{Ax+B}{\left(ax^2 + bx +c \right)^n}
              </me>
            where <m>A</m>, <m>B</m>,
            and <m>c</m> are real numbers,
            and <m>k</m> is a positive real number.
          </p>
        </li>

        <li>
          <p>
            Which of the forms are included in the decomposition of a rational function depends entirely on the factored form of the denominator,
            and each of those forms can be integrated using basic integrals, substitution, and/or trigonometric substitution, possibly requiring some algebra.
          </p>
        </li>

        <li>
          <p>
            Similar to how every improper fraction can be expressed as an integer plus a proper fraction, every rational function with the degree of the numerator greater than or equal to the degree 
            of the denominator can be expressed as <m>p(x)+\frac{q(x)}{r(x)}</m> where <m>p(x)</m> is a polynomial
            and the degree of <m>q(x)</m> is strictly less than the degree of <m>r(x)</m>.
          </p>
        </li>

        <li>
          <p>
            This means that every rational function has an antiderivative function we can express without an integral.
          </p>
        </li>
      </ul>
    </p>
  </subsection>

  <!-- <xi:include href="./exercises/ez-1-1.xml" /> -->
</section>
